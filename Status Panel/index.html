<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>服务器监控面板</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #34a853;
            --warning-color: #fbbc05;
            --danger-color: #ea4335;
            /* 背景将在JavaScript中动态设置 */
            --background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            --text-color: #ffffff;
            --text-secondary: #e0e0e0;
            --border-radius: 16px;
            --spacing: 24px;
            --blur: 20px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.45);
            --accent-color: #8a2be2;
            --success-color: #00c853;
            --card-bg: rgba(20, 20, 30, 0.65);
            --card-border: rgba(255, 255, 255, 0.4);
            --node-selected-bg: rgba(66, 133, 244, 0.35);
            --node-hover-bg: rgba(255, 255, 255, 0.15);
            --node-offline-bg: rgba(234, 67, 53, 0.15);
            --progress-bar-bg: rgba(255, 255, 255, 0.1);
            --progress-indicator: #4285f4;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }
        body {
            background: var(--background) no-repeat center center fixed;
            background-size: cover;
            color: var(--text-color);
            min-height: 100vh;
            padding: var(--spacing);
            display: flex;
            flex-direction: column;
            position: relative;
            line-height: 1.6;
            transition: background 0.5s ease;
        }
        .header-panel {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing);
            gap: var(--spacing);
        }
        .info-panel {
            flex: 1;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            backdrop-filter: blur(var(--blur));
            -webkit-backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow);
            border: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .info-row {
            display: flex;
            gap: 30px;
        }
        .info-item {
            display: flex;
            flex-direction: column;
        }
        .info-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 5px;
        }
        .info-value {
            font-size: 18px;
            font-weight: 600;
            color: white;
        }
        .traffic-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding-left: 30px;
            margin-left: 30px;
            border-left: 1px solid rgba(255, 255, 255, 0.35);
        }
        .traffic-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .traffic-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        .traffic-value {
            font-size: 18px;
            font-weight: 600;
            color: white;
        }
        .status-panel {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            backdrop-filter: blur(var(--blur));
            -webkit-backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow);
            border: 1px solid var(--card-border);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-width: 200px;
            position: relative;
        }
        .status-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            width: 100%;
        }
        .status-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            border-radius: 10px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        .node-selector {
            position: absolute;
            top: 100%;
            right: 0;
            width: 200px; /* 与status-panel相同宽度 */
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 15px;
            backdrop-filter: blur(var(--blur));
            -webkit-backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow);
            border: 1px solid var(--card-border);
            z-index: 10;
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }
        .node-selector.active {
            display: block;
        }
        .node-item-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2列布局 */
            gap: 8px;
        }
        .node-item {
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            text-align: center;
        }
        .node-item:hover {
            background: var(--node-hover-bg);
        }
        .node-item.selected {
            background: var(--node-selected-bg);
            border: 1px solid var(--primary-color);
        }
        .node-icon {
            font-size: 20px;
            margin-bottom: 5px;
            color: var(--text-secondary);
        }
        .node-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .node-status {
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .node-status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        .node-status-dot.online {
            background-color: var(--success-color);
        }
        .node-status-dot.offline {
            background-color: var(--danger-color);
        }
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--success-color);
            box-shadow: 0 0 10px var(--success-color);
        }
        .status-dot.offline {
            background-color: var(--danger-color);
            box-shadow: 0 0 10px var(--danger-color);
        }
        .status-text {
            font-size: 20px;
            font-weight: 600;
        }
        .main-container {
            display: flex;
            flex: 1;
            gap: var(--spacing);
            margin-bottom: var(--spacing);
        }
        .system-panel {
            flex: 3;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing);
        }
        .game-panel {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: var(--spacing);
        }
        .game-status-container {
            display: flex;
            gap: var(--spacing);
            flex-direction: column;
            flex: 1;
        }
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            backdrop-filter: blur(var(--blur));
            -webkit-backdrop-filter: blur(var(--blur));
            box-shadow: var(--shadow);
            border: 1px solid var(--card-border);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
            overflow: hidden;
            position: relative;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 22px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.35);
        }
        .card-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }
        .card-title i {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
        }
        .chart-container {
            height: 220px;
            position: relative;
        }
        .game-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 15px;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 14px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(5px);
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.25);
        }
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.25);
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
        }
        .stat-value {
            font-size: 32px;
            font-weight: 800;
            margin: 5px 0;
            color: white;
        }
        .stat-label {
            font-size: 15px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        .weather-icon {
            font-size: 46px;
            margin: 12px 0;
            color: white;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.7);
        }
        .players-list {
            margin-top: 16px;
            max-height: 250px;
            overflow-y: auto;
            padding-right: 5px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .player-id {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(3px);
        }
        .player-id:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }
        .node-details-panel {
            display: none;
            flex-direction: column;
            gap: var(--spacing);
        }
        .node-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .info-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        .info-box-title {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }
        .info-box-value {
            font-size: 18px;
            font-weight: 600;
            color: white;
        }
        .storage-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 8px;
        }
        .storage-fill {
            height: 100%;
            border-radius: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        .back-to-game-btn {
            cursor: pointer;
            color: white;
            font-size: 13px;
            margin: 15px 0;
            display: inline-block;
        }
        .back-to-game-btn:hover {
            text-decoration: underline;
        }
        .offline-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(15px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }
        .offline-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        .modal-content {
            background: rgba(20, 20, 30, 0.85);
            border-radius: var(--border-radius);
            padding: 50px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.7);
            transform: translateY(30px);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(12px);
            border: 1px solid var(--card-border);
        }
        .offline-modal.active .modal-content {
            transform: translateY(0);
        }
        .modal-content h2 {
            font-size: 32px;
            margin-bottom: 20px;
            color: var(--danger-color);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        .modal-content p {
            font-size: 18px;
            margin-bottom: 30px;
            color: var(--text-secondary);
            line-height: 1.8;
        }
        .confirm-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 14px 40px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .confirm-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4);
            background: rgba(255, 255, 255, 0.3);
        }
        /* 优化：节点选择模态框样式 */
        .node-selector-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(15px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }
        .node-selector-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        .node-selector-modal .modal-content {
            background: rgba(20, 20, 30, 0.85);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.7);
            transform: translateY(30px);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(12px);
            border: 1px solid var(--card-border);
        }
        .node-selector-modal.active .modal-content {
            transform: translateY(0);
        }
        .node-selector-modal h2 {
            font-size: 20px;
            margin-bottom: 15px;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .node-item-grid-modal {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            margin: 15px 0;
        }
        .node-item-modal {
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.08);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60px;
            width: 100%;
            background: rgba(255, 255, 255, 0.03);
        }
        .node-item-modal:hover {
            background: var(--node-hover-bg);
            border-color: rgba(255, 255, 255, 0.2);
        }
        .node-item-modal.selected {
            background: var(--node-selected-bg);
            border: 1px solid var(--primary-color);
        }
        .node-item-modal.offline {
            opacity: 0.7;
            cursor: not-allowed;
        }
        .node-item-modal.offline:hover {
            background: var(--node-offline-bg);
        }
        .node-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            width: 100%;
            margin-bottom: 3px;
        }
        .node-header .node-icon {
            font-size: 16px;
            flex-shrink: 0;
            color: var(--text-secondary);
        }
        .node-header .node-name {
            font-weight: 600;
            font-size: 14px;
            color: white;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            width: 100%;
        }
        .node-status {
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.08);
            width: auto;
            margin: 0 auto;
        }
        .node-status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        .node-status-dot.online {
            background-color: var(--success-color);
        }
        .node-status-dot.offline {
            background-color: var(--danger-color);
        }
        .node-status-text {
            color: var(--text-secondary);
        }
        
        /* 进度条加载动画 */
        .loading-bar {
            width: 100%;
            height: 4px;
            background: var(--progress-bar-bg);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 3px;
            position: relative;
        }
        
        .loading-progress {
            height: 100%;
            width: 15px;
            background: var(--progress-indicator);
            border-radius: 2px;
            position: absolute;
            animation: progressMove 1.5s infinite ease-in-out;
        }
        
        @keyframes progressMove {
            0% { left: 0; }
            50% { left: calc(100% - 15px); }
            100% { left: 0; }
        }
        
        .offline-tip {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--node-offline-bg);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 100;
        }
        .node-item-modal.offline:hover .offline-tip {
            opacity: 1;
        }
        .footer {
            margin-top: auto;
            text-align: center;
            color: var(--text-secondary);
            padding-top: var(--spacing);
            border-top: 1px solid rgba(255, 255, 255, 0.25);
            font-size: 14px;
            font-weight: 500;
            backdrop-filter: blur(3px);
            padding: 15px;
            border-radius: var(--border-radius);
            background: rgba(0, 0, 0, 0.3);
        }
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            min-height: 200px;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .no-players {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
            font-style: italic;
        }
        /* 响应式设计 */
        @media (max-width: 1200px) {
            .header-panel {
                flex-direction: column;
            }
            .info-panel {
                width: 100%;
            }
            .status-panel {
                width: 100%;
            }
        }
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            .system-panel {
                order: 2;
            }
            .game-panel {
                order: 1;
            }
            .game-status-container {
                flex-direction: column;
            }
        }
        @media (max-width: 768px) {
            :root {
                --spacing: 15px;
            }
            .system-panel {
                grid-template-columns: 1fr;
            }
            .game-stats {
                grid-template-columns: 1fr;
            }
            .info-row {
                flex-direction: column;
                gap: 15px;
            }
            .traffic-panel {
                padding-left: 0;
                margin-left: 0;
                border-left: none;
                border-top: 1px solid rgba(255, 255, 255, 0.25);
                padding-top: 15px;
                margin-top: 15px;
                width: 100%;
            }
            .node-item-grid-modal {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            .card {
                padding: 15px;
            }
            .stat-value {
                font-size: 28px;
            }
            .modal-content {
                padding: 25px;
            }
            .node-item-grid-modal {
                grid-template-columns: 1fr;
            }
            .node-item-modal {
                height: auto;
                padding: 10px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- 标题区域 -->
    <div class="header-panel">
        <div class="info-panel">
            <div class="info-row">
                <div class="info-item">
                    <span class="info-label">节点</span>
                    <span class="info-value" id="node-value">CN-East-JX</span>
                </div>
                <div class="info-item">
                    <span class="info-label">CPU 核心</span>
                    <span class="info-value" id="cpu-cores-value">8 核心</span>
                </div>
                <div class="info-item">
                    <span class="info-label">内存</span>
                    <span class="info-value" id="memory-total-value">16 GB</span>
                </div>
                <div class="info-item">
                    <span class="info-label">在线时间</span>
                    <span class="info-value" id="uptime-value">0小时</span>
                </div>
            </div>
            <div class="traffic-panel">
                <div class="traffic-item">
                    <span class="traffic-label">总上传：</span>
                    <span class="traffic-value" id="total-upload-value">0.000 GB</span>
                </div>
                <div class="traffic-item">
                    <span class="traffic-label">总下载：</span>
                    <span class="traffic-value" id="total-download-value">0.000 GB</span>
                </div>
            </div>
        </div>
        <div class="status-panel">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span class="status-text">运行中</span>
            </div>
            <div class="status-controls">
                <button class="status-btn" id="node-selector-btn"><i class="fas fa-sitemap"></i> 节点</button>
            </div>
        </div>
    </div>
    <!-- 主要内容区域 -->
    <div class="main-container">
        <!-- 左侧系统监控面板 (2x2布局) -->
        <div class="system-panel">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-microchip"></i> CPU 使用率</h2>
                    <span id="cpu-value">0%</span>
                </div>
                <div class="chart-container">
                    <canvas id="cpu-chart"></canvas>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-memory"></i> 内存使用</h2>
                    <span id="memory-value">0GB/0GB</span>
                </div>
                <div class="chart-container">
                    <canvas id="memory-chart"></canvas>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-network-wired"></i> 网络流量</h2>
                    <span id="network-value">0Mbps</span>
                </div>
                <div class="chart-container">
                    <canvas id="network-chart"></canvas>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-hdd"></i> 磁盘活动</h2>
                    <!-- 修改单位显示为MB/s -->
                    <span id="disk-value">0MB/s</span>
                </div>
                <div class="chart-container">
                    <canvas id="disk-chart"></canvas>
                </div>
            </div>
        </div>
        <!-- 右侧游戏状态面板 -->
        <div class="game-panel" id="game-panel">
            <div class="game-status-container">
                <div class="card" id="game-status-card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-gamepad"></i> 服务器状态</h2>
                        <button class="status-btn" id="node-details-btn" style="padding: 6px 12px; margin-left: 10px;">
                            <i class="fas fa-server"></i> 详情
                        </button>
                    </div>
                    <div class="game-stats">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-value" id="player-count">0</div>
                            <div class="stat-label">在线玩家</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="stat-value" id="tps">0</div>
                            <div class="stat-label">TPS</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-cloud"></i>
                            </div>
                            <div class="weather-icon" id="weather-icon"><i class="fas fa-sun"></i></div>
                            <div class="stat-label" id="weather-text">晴</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-code-branch"></i>
                            </div>
                            <div class="stat-value" id="version">v?.?.?</div>
                            <div class="stat-label">游戏版本</div>
                        </div>
                    </div>
                </div>
                <div class="card" id="node-details-card" style="display: none;">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-server"></i> 节点详情</h2>
                        <span id="back-to-game-btn" style="cursor: pointer; color: white; font-size: 13px; margin: 15px 0; display: inline-block;">←返回</span>
                    </div>
                    <div class="node-info-grid">
                        <div class="info-box">
                            <div class="info-box-title">节点名称</div>
                            <div class="info-box-value" id="node-detail-name">CN-East-JX</div>
                        </div>
                        <div class="info-box">
                            <div class="info-box-title">系统类型</div>
                            <div class="info-box-value" id="node-detail-system">-</div>
                        </div>
                        <div class="info-box">
                            <div class="info-box-title">CPU 信息</div>
                            <div class="info-box-value" id="node-detail-cpu">-</div>
                        </div>
                        <div class="info-box">
                            <div class="info-box-title">CPU 使用率</div>
                            <div class="info-box-value" id="node-detail-cpu-usage">-</div>
                        </div>
                        <div class="info-box">
                            <div class="info-box-title">内存总量</div>
                            <div class="info-box-value" id="node-detail-mem-total">-</div>
                        </div>
                        <div class="info-box">
                            <div class="info-box-title">内存使用</div>
                            <div class="info-box-value" id="node-detail-mem-used">-</div>
                        </div>
                        <div class="info-box" style="grid-column: span 2;">
                            <div class="info-box-title">内存使用情况</div>
                            <div class="storage-bar">
                                <div class="storage-fill" id="node-detail-mem-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="info-box">
                            <div class="info-box-title">存储总量</div>
                            <div class="info-box-value" id="node-detail-storage-total">-</div>
                        </div>
                        <div class="info-box">
                            <div class="info-box-title">存储使用</div>
                            <div class="info-box-value" id="node-detail-storage-used">-</div>
                        </div>
                        <div class="info-box" style="grid-column: span 2;">
                            <div class="info-box-title">存储使用情况</div>
                            <div class="storage-bar">
                                <div class="storage-fill" id="node-detail-storage-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card" id="players-list-card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-user-friends"></i> 在线玩家</h2>
                    <span id="online-players">0/100</span>
                </div>
                <div class="players-list" id="players-list">
                    <div class="no-players">正在加载玩家数据...</div>
                </div>
            </div>
        </div>
    </div>
    <!-- 离线模态框 -->
    <div class="offline-modal" id="offline-modal">
        <div class="modal-content">
            <h2><i class="fas fa-exclamation-triangle"></i> 服务器离线</h2>
            <p id="offline-message">无法连接到服务器，请检查服务器状态或网络连接。</p>
            <button class="confirm-btn" id="confirm-btn">确认</button>
        </div>
    </div>
    <!-- 节点选择模态框 -->
    <div class="node-selector-modal" id="node-selector-modal">
        <div class="modal-content">
            <h2><i class="fas fa-sitemap"></i> 选择节点</h2>
            <div class="node-item-grid-modal" id="node-selector-grid-modal">
                <!-- 节点列表将由JS动态填充 -->
            </div>
            <button class="confirm-btn" id="close-node-selector-modal">关闭</button>
        </div>
    </div>
    <!-- 页脚 -->
    <div class="footer">
        <p><span id="footer-text">Server Monitor v1.0</span> | 最后更新: <span id="update-time">--:--:--</span> | 数据刷新: <span id="refresh-rate">1</span>秒</p>
    </div>
    <script>
        // 配置信息
        const appConfig = {
            currentNodeIndex: 0,
            currentView: 'game', // 'game' 或 'node-details'
            lastOfflineAlertTime: 0,
            offlineAlertInterval: 60000, // 60秒
            refreshInterval: 1000, // 1秒
            maxDataPoints: 30, // 图表显示的最大数据点数
            config: {
                title: "服务器监控面板",
                ico: "favicon.ico",
                foot: "Server Monitor v1.0",
                bg: "https://images.unsplash.com/photo-1555066931-4365d14bab8c?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80",
                nodes: [
                    {
                        name: "CN-East-JX",
                        apiurl: "http://127.0.0.1:8000"
                    },
                    {
                        name: "US-West-CA",
                        apiurl: "http://us-west.example.com:8000"
                    },
                    {
                        name: "EU-Central-DE",
                        apiurl: "http://eu-central.example.com:8000"
                    },
                    {
                        name: "CN-South-GZ",
                        apiurl: "http://cn-south.example.com:8000"
                    },
                    {
                        name: "SG-East",
                        apiurl: "http://sg-east.example.com:8000"
                    },
                    {
                        name: "JP-Tokyo",
                        apiurl: "http://jp-tokyo.example.com:8000"
                    }
                ]
            }
        };
        // 图表实例
        let cpuChart, memoryChart, networkChart, diskChart;
        // 图表数据
        const chartData = {
            cpu: {
                labels: [],
                values: []
            },
            memory: {
                labels: [],
                values: []
            },
            network: {
                labels: [],
                download: [],
                upload: []
            },
            disk: {
                labels: [],
                read: [],
                write: []
            }
        };
        // 天气映射
        const weatherMap = {
            "Clear": { text: "晴", icon: "fas fa-sun" },
            "Rain": { text: "雨", icon: "fas fa-cloud-rain" },
            "Thunderstorm": { text: "雷暴", icon: "fas fa-bolt" },
            "Snow": { text: "雪", icon: "fas fa-snowflake" },
            "Cloudy": { text: "多云", icon: "fas fa-cloud" }
        };
        // 安全添加 favicon 的函数
        function safeAddFavicon() {
            try {
                // 检查document对象是否存在
                if (typeof document === 'undefined') {
                    console.error('document对象不存在');
                    return;
                }
                // 检查head元素是否存在
                const heads = document.getElementsByTagName('head');
                if (!heads || heads.length === 0) {
                    console.error('head元素不存在');
                    return;
                }
                const head = heads[0];
                if (!head || typeof head.appendChild !== 'function') {
                    console.error('head元素无效');
                    return;
                }
                // 检查link元素
                let link = document.querySelector("link[rel*='icon']");
                if (!link) {
                    link = document.createElement('link');
                    link.type = 'image/x-icon';
                    link.rel = 'shortcut icon';
                    head.appendChild(link);
                }
                // 设置favicon
                link.href = appConfig.config.ico;
            } catch (error) {
                console.error('设置favicon时出错:', error);
            }
        }
        // 添加带超时的fetch函数
        function fetchWithTimeout(url, options = {}, timeout = 3000) {
            return Promise.race([
                fetch(url, options),
                new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('请求超时')), timeout)
                )
            ]);
        }
        // 显示节点离线提示
        function showNodeOfflineTip(message) {
            const offlineModal = document.getElementById('offline-modal');
            const offlineMessage = document.getElementById('offline-message');
            
            if (offlineMessage && message) {
                offlineMessage.textContent = message;
            }
            
            if (offlineModal) {
                offlineModal.classList.add('active');
            }
            
            // 3秒后自动隐藏
            setTimeout(() => {
                if (offlineModal) {
                    offlineModal.classList.remove('active');
                }
            }, 3000);
        }
        // 初始化应用
        async function initApp() {
            try {
                // 加载配置文件
                const configResponse = await fetch('config.json');
                if (configResponse.ok) {
                    appConfig.config = await configResponse.json();
                } else {
                    console.log('使用默认配置');
                }
                // 设置页面标题
                document.title = appConfig.config.title;
                // 安全地添加favicon
                safeAddFavicon();
                // 更新背景
                updateBackground(appConfig.config.bg);
                // 初始化UI
                initUI();
                // 初始化图表
                initCharts();
                // 初始加载数据
                fetchDataForCurrentNode();
                // 设置定时刷新
                setInterval(fetchDataForCurrentNode, appConfig.refreshInterval);
            } catch (error) {
                console.error('初始化应用失败:', error);
                showOfflineStatus(`初始化失败: ${error.message}`);
            }
        }
        // 初始化UI
        function initUI() {
            // 设置页脚
            document.getElementById('footer-text').textContent = appConfig.config.foot;
            // 设置节点选择器（用于下拉菜单，保持原有功能）
            const nodeSelectorGrid = document.querySelector('#node-selector .node-item-grid');
            if (nodeSelectorGrid) {
                appConfig.config.nodes.forEach((node, index) => {
                    const nodeItem = document.createElement('div');
                    nodeItem.className = 'node-item';
                    nodeItem.innerHTML = `
                        <div class="node-icon"><i class="fas fa-server"></i></div>
                        <div class="node-name" title="${node.name}">${node.name}</div>
                        <div class="node-status">
                            <span class="node-status-dot offline"></span>
                            <span class="node-status-text">离线</span>
                        </div>
                    `;
                    nodeItem.dataset.index = index;
                    nodeItem.dataset.name = node.name;
                    nodeItem.dataset.url = node.apiurl;
                    nodeSelectorGrid.appendChild(nodeItem);
                    // 添加点击事件
                    nodeItem.addEventListener('click', () => {
                        appConfig.currentNodeIndex = index;
                        document.querySelectorAll('.node-item').forEach(item => {
                            item.classList.remove('selected');
                        });
                        nodeItem.classList.add('selected');
                        document.getElementById('node-value').textContent = node.name;
                        document.getElementById('node-selector').classList.remove('active');
                        fetchDataForCurrentNode();
                    });
                });
                // 设置初始选中节点
                const firstNodeItem = document.querySelector(`.node-item[data-index="0"]`);
                if (firstNodeItem) {
                    firstNodeItem.classList.add('selected');
                }
                document.getElementById('node-value').textContent = appConfig.config.nodes[0].name;
            }
            // 添加节点选择按钮事件（打开模态框）
            const nodeSelectorBtn = document.getElementById('node-selector-btn');
            if (nodeSelectorBtn) {
                nodeSelectorBtn.addEventListener('click', () => {
                    // 直接打开面板
                    document.getElementById('node-selector-modal').classList.add('active');
                    // 立即填充节点列表，显示"连接中"状态
                    populateNodeSelectorModal(true);
                    // 后台异步检查节点状态
                    checkAllNodeStatuses().then(() => {
                        populateNodeSelectorModal(false);
                    }).catch(error => {
                        console.error('检查节点状态失败:', error);
                        populateNodeSelectorModal(false);
                    });
                });
            }
            
            // 添加节点详情按钮事件
            const nodeDetailsBtn = document.getElementById('node-details-btn');
            if (nodeDetailsBtn) {
                nodeDetailsBtn.addEventListener('click', () => {
                    // 切换到节点详情视图
                    appConfig.currentView = 'node-details';
                    updateViewBasedOnNodeType();
                });
            }
            
            // 添加返回游戏服务器按钮事件
            const backToGameBtn = document.getElementById('back-to-game-btn');
            if (backToGameBtn) {
                backToGameBtn.addEventListener('click', () => {
                    // 切换到游戏状态视图
                    appConfig.currentView = 'game';
                    updateViewBasedOnNodeType();
                });
            }
            
            // 添加确认按钮事件
            const confirmBtn = document.getElementById('confirm-btn');
            if (confirmBtn) {
                confirmBtn.addEventListener('click', () => {
                    document.getElementById('offline-modal').classList.remove('active');
                    fetchDataForCurrentNode();
                });
            }
            
            // 添加关闭节点选择模态框按钮事件
            const closeNodeSelectorModal = document.getElementById('close-node-selector-modal');
            if (closeNodeSelectorModal) {
                closeNodeSelectorModal.addEventListener('click', () => {
                    document.getElementById('node-selector-modal').classList.remove('active');
                });
            }
            
            // 点击模态框外部关闭
            const nodeSelectorModal = document.getElementById('node-selector-modal');
            if (nodeSelectorModal) {
                nodeSelectorModal.addEventListener('click', (event) => {
                    if (event.target === nodeSelectorModal) {
                        nodeSelectorModal.classList.remove('active');
                    }
                });
            }
            
            // 初始化所有节点状态为未知
            appConfig.config.nodes.forEach((node, index) => {
                node.status = 'unknown';
            });
        }
        
        // 检查所有节点状态
        async function checkAllNodeStatuses() {
            const nodes = appConfig.config.nodes;
            const checkPromises = nodes.map(async (node, index) => {
                try {
                    const response = await fetchWithTimeout(node.apiurl, { 
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                        },
                        mode: 'cors',
                        cache: 'no-cache'
                    }, 3000); // 3秒超时
                    const data = await response.json();
                    if (data.code === 200) {
                        updateNodeStatus(index, 'online');
                        appConfig.config.nodes[index].status = 'online';
                        return true;
                    }
                    return false;
                } catch (error) {
                    updateNodeStatus(index, 'offline');
                    appConfig.config.nodes[index].status = 'offline';
                    return false;
                }
            });
            await Promise.all(checkPromises);
        }
        
        // 填充节点选择模态框
        function populateNodeSelectorModal(isChecking = false) {
            const nodeSelectorGrid = document.getElementById('node-selector-grid-modal');
            if (!nodeSelectorGrid) return;
            nodeSelectorGrid.innerHTML = '';
            appConfig.config.nodes.forEach((node, index) => {
                const nodeItem = document.createElement('div');
                nodeItem.className = 'node-item-modal';
                if (index === appConfig.currentNodeIndex) {
                    nodeItem.classList.add('selected');
                }
                // 如果节点离线，添加离线类
                if (appConfig.config.nodes[index].status === 'offline') {
                    nodeItem.classList.add('offline');
                }
                
                let statusDotClass, statusText;
                // 如果正在检查状态或节点状态未知，显示连接中
                if (isChecking || appConfig.config.nodes[index].status === 'unknown') {
                    statusDotClass = 'offline';
                    statusText = '检查中';
                    nodeItem.innerHTML = `
                        <div class="node-header">
                            <div class="node-icon"><i class="fas fa-server"></i></div>
                            <div class="node-name" title="${node.name}">${node.name}</div>
                        </div>
                        <div class="node-status">
                            <span class="node-status-dot ${statusDotClass}"></span>
                            <span class="node-status-text">${statusText}</span>
                        </div>
                        <div class="loading-bar">
                            <div class="loading-progress"></div>
                        </div>
                    `;
                } else {
                    const nodeStatus = appConfig.config.nodes[index].status || 'offline';
                    statusDotClass = nodeStatus === 'online' ? 'online' : 'offline';
                    statusText = nodeStatus === 'online' ? '在线' : '离线';
                    nodeItem.innerHTML = `
                        <div class="node-header">
                            <div class="node-icon"><i class="fas fa-server"></i></div>
                            <div class="node-name" title="${node.name}">${node.name}</div>
                        </div>
                        <div class="node-status">
                            <span class="node-status-dot ${statusDotClass}"></span>
                            <span class="node-status-text">${statusText}</span>
                        </div>
                        <div class="loading-bar" style="opacity: 0;">
                            <div class="loading-progress"></div>
                        </div>
                    `;
                }
                
                // 为离线节点添加提示
                if (appConfig.config.nodes[index].status === 'offline') {
                    const tip = document.createElement('div');
                    tip.className = 'offline-tip';
                    tip.textContent = '节点离线，无法切换';
                    nodeItem.appendChild(tip);
                }
                
                nodeItem.dataset.index = index;
                nodeItem.dataset.name = node.name;
                nodeItem.dataset.url = node.apiurl;
                // 添加点击事件
                nodeItem.addEventListener('click', () => {
                    // 如果是离线节点，不切换并显示提示
                    if (appConfig.config.nodes[index].status === 'offline') {
                        showNodeOfflineTip(`无法切换到离线节点: ${node.name}`);
                        return;
                    }
                    
                    appConfig.currentNodeIndex = index;
                    document.querySelectorAll('.node-item-modal').forEach(item => {
                        item.classList.remove('selected');
                    });
                    nodeItem.classList.add('selected');
                    document.getElementById('node-value').textContent = node.name;
                    document.getElementById('node-selector-modal').classList.remove('active');
                    fetchDataForCurrentNode();
                });
                nodeSelectorGrid.appendChild(nodeItem);
            });
        }
        
        // 根据节点类型更新视图
        function updateViewBasedOnNodeType() {
            const gameStatusCard = document.getElementById('game-status-card');
            const playersListCard = document.getElementById('players-list-card');
            const nodeDetailsCard = document.getElementById('node-details-card');
            const hasGameServer = appConfig.config.nodes[appConfig.currentNodeIndex].hasGameServer;
            
            // 如果当前视图是游戏状态
            if (appConfig.currentView === 'game') {
                if (hasGameServer) {
                    // 如果有游戏服务器，显示游戏状态面板
                    gameStatusCard.style.display = 'block';
                    playersListCard.style.display = 'block';
                    nodeDetailsCard.style.display = 'none';
                } else {
                    // 如果没有游戏服务器，自动切换到节点详情视图
                    appConfig.currentView = 'node-details';
                    gameStatusCard.style.display = 'none';
                    playersListCard.style.display = 'none';
                    nodeDetailsCard.style.display = 'block';
                }
            } 
            // 如果当前视图是节点详情
            else if (appConfig.currentView === 'node-details') {
                // 无论是否有游戏服务器，都显示节点详情
                gameStatusCard.style.display = 'none';
                playersListCard.style.display = 'none';
                nodeDetailsCard.style.display = 'block';
            }
            
            // 更新"详情"按钮的文本
            const nodeDetailsBtn = document.getElementById('node-details-btn');
            if (nodeDetailsBtn) {
                nodeDetailsBtn.innerHTML = `<i class="fas fa-server"></i> ${appConfig.currentView === 'game' ? '详情' : '返回'}`;
            }
            
            // 更新"返回游戏"按钮的显示
            const backToGameBtn = document.getElementById('back-to-game-btn');
            if (backToGameBtn) {
                backToGameBtn.style.display = hasGameServer && appConfig.currentView === 'node-details' ? 'inline-block' : 'none';
            }
        }
        
        // 更新UI显示
        function updateUI(data) {
            const now = new Date();
            const updateTimeEl = document.getElementById('update-time');
            if (updateTimeEl) {
                updateTimeEl.textContent = 
                    `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            }
            const refreshRateEl = document.getElementById('refresh-rate');
            if (refreshRateEl) {
                refreshRateEl.textContent = appConfig.refreshInterval / 1000;
            }
            // 更新配置信息
            updateBackground(data.config ? data.config.bg : appConfig.config.bg);
            const footerTextEl = document.getElementById('footer-text');
            if (footerTextEl) {
                footerTextEl.textContent = data.config ? data.config.footer : appConfig.config.foot;
            }
            // 更新系统状态
            const sys = data.system_status;
            const cpuCoresValueEl = document.getElementById('cpu-cores-value');
            if (cpuCoresValueEl) {
                cpuCoresValueEl.textContent = sys.cpu_cores + ' 核心';
            }
            // 修改点：使用memory_total_gb代替memory_total_int_gb
            const memoryTotalValueEl = document.getElementById('memory-total-value');
            if (memoryTotalValueEl) {
                memoryTotalValueEl.textContent = sys.memory_total_gb.toFixed(2) + ' GB';
            }
            const cpuValueEl = document.getElementById('cpu-value');
            if (cpuValueEl) {
                cpuValueEl.textContent = `${sys.cpu_usage_percent.toFixed(1)}%`;
            }
            const memoryValueEl = document.getElementById('memory-value');
            if (memoryValueEl) {
                memoryValueEl.textContent = 
                    `${sys.memory_used_gb.toFixed(1)}GB/${sys.memory_total_gb.toFixed(1)}GB`;
            }
            const networkValueEl = document.getElementById('network-value');
            if (networkValueEl) {
                networkValueEl.textContent = 
                    `↓${sys.net_download_rate_mbps.toFixed(2)} ↑${sys.net_upload_rate_mbps.toFixed(2)} Mbps`;
            }
            // 修改点：磁盘速率单位改为MB/s
            const diskValueEl = document.getElementById('disk-value');
            if (diskValueEl) {
                diskValueEl.textContent = 
                    `↓${sys.disk_read_rate_mbs.toFixed(2)} ↑${sys.disk_write_rate_mbs.toFixed(2)} MB/s`;
            }
            const uptimeValueEl = document.getElementById('uptime-value');
            if (uptimeValueEl) {
                uptimeValueEl.textContent = 
                    `${sys.system_uptime_hours.toFixed(1)}小时`;
            }
            // 更新网络总量
            const totalUploadValueEl = document.getElementById('total-upload-value');
            if (totalUploadValueEl) {
                totalUploadValueEl.textContent = 
                    `${sys.net_total_upload_gb.toFixed(3)} GB`;
            }
            const totalDownloadValueEl = document.getElementById('total-download-value');
            if (totalDownloadValueEl) {
                totalDownloadValueEl.textContent = 
                    `${sys.net_total_download_gb.toFixed(3)} GB`;
            }
            // 更新图表
            if (cpuChart) {
                updateChartData(cpuChart, sys.cpu_usage_percent, appConfig.maxDataPoints);
            }
            if (memoryChart) {
                updateChartData(memoryChart, (sys.memory_used_gb / sys.memory_total_gb * 100), appConfig.maxDataPoints);
            }
            if (networkChart) {
                updateDualChartData(
                    networkChart, 
                    sys.net_download_rate_mbps, 
                    sys.net_upload_rate_mbps, 
                    appConfig.maxDataPoints
                );
            }
            if (diskChart) {
                // 修改点：磁盘图表数据字段名称更新
                updateDualChartData(
                    diskChart, 
                    sys.disk_read_rate_mbs, 
                    sys.disk_write_rate_mbs, 
                    appConfig.maxDataPoints
                );
            }
            // 检查是否有游戏服务器信息
            const hasGameServer = data.hasOwnProperty('game_server_status');
            // 标记当前节点是否有游戏服务器
            appConfig.config.nodes[appConfig.currentNodeIndex].hasGameServer = hasGameServer;
            
            // 更新游戏状态（如果存在）
            if (hasGameServer) {
                const game = data.game_server_status;
                const playerCountEl = document.getElementById('player-count');
                if (playerCountEl) {
                    playerCountEl.textContent = game.playerCount;
                }
                const tpsEl = document.getElementById('tps');
                if (tpsEl) {
                    tpsEl.textContent = game.tps;
                }
                const versionEl = document.getElementById('version');
                if (versionEl) {
                    versionEl.textContent = game.version;
                }
                const onlinePlayersEl = document.getElementById('online-players');
                if (onlinePlayersEl) {
                    onlinePlayersEl.textContent = `${game.playerCount}/${game.maxPlayers}`;
                }
                // 更新天气
                const weather = weatherMap[game.weather] || { text: game.weather, icon: "fas fa-question" };
                const weatherIconEl = document.getElementById('weather-icon');
                if (weatherIconEl) {
                    weatherIconEl.innerHTML = `<i class="${weather.icon}"></i>`;
                }
                const weatherTextEl = document.getElementById('weather-text');
                if (weatherTextEl) {
                    weatherTextEl.textContent = weather.text;
                }
                // 更新在线玩家列表
                const playersListEl = document.getElementById('players-list');
                if (playersListEl) {
                    if (game.onlinePlayers && game.onlinePlayers.length > 0) {
                        playersListEl.innerHTML = '';
                        game.onlinePlayers.forEach(player => {
                            const playerElement = document.createElement('div');
                            playerElement.className = 'player-id';
                            playerElement.textContent = player;
                            playersListEl.appendChild(playerElement);
                        });
                    } else {
                        playersListEl.innerHTML = '<div class="no-players">当前没有在线玩家</div>';
                    }
                }
            }
            // 更新节点详情面板
            updateNodeDetailsPanel(data, hasGameServer);
            
            // 根据节点类型更新视图
            updateViewBasedOnNodeType();
        }
        
        // 更新节点详情面板
        function updateNodeDetailsPanel(data, hasGameServer = true) {
            const sys = data.system_status;
            // 基本信息
            const nodeDetailNameEl = document.getElementById('node-detail-name');
            if (nodeDetailNameEl) {
                nodeDetailNameEl.textContent = appConfig.config.nodes[appConfig.currentNodeIndex].name;
            }
            const nodeDetailSystemEl = document.getElementById('node-detail-system');
            if (nodeDetailSystemEl) {
                nodeDetailSystemEl.textContent = 
                    `${sys.system_type} (内核: ${sys.system_kernel})`;
            }
            // 修改CPU信息格式：核显数量 x cpu名称 @ cpu基准频率
            const nodeDetailCpuEl = document.getElementById('node-detail-cpu');
            if (nodeDetailCpuEl) {
                nodeDetailCpuEl.textContent = 
                    `${sys.cpu_cores}x ${sys.cpu_name} @ ${sys.cpu_base_freq_ghz}GHz`;
            }
            const nodeDetailCpuUsageEl = document.getElementById('node-detail-cpu-usage');
            if (nodeDetailCpuUsageEl) {
                nodeDetailCpuUsageEl.textContent = 
                    `${sys.cpu_usage_percent.toFixed(1)}%`;
            }
            // 内存信息
            const memPercent = (sys.memory_used_gb / sys.memory_total_gb * 100).toFixed(1);
            const nodeDetailMemTotalEl = document.getElementById('node-detail-mem-total');
            if (nodeDetailMemTotalEl) {
                nodeDetailMemTotalEl.textContent = 
                    `${sys.memory_total_gb.toFixed(2)} GB`;
            }
            const nodeDetailMemUsedEl = document.getElementById('node-detail-mem-used');
            if (nodeDetailMemUsedEl) {
                nodeDetailMemUsedEl.textContent = 
                    `${sys.memory_used_gb.toFixed(2)} GB (${memPercent}%)`;
            }
            const nodeDetailMemBarEl = document.getElementById('node-detail-mem-bar');
            if (nodeDetailMemBarEl) {
                nodeDetailMemBarEl.style.width = `${memPercent}%`;
            }
            // 存储信息
            const storagePercent = (sys.root_disk_used_gb / sys.root_disk_total_gb * 100).toFixed(1);
            const nodeDetailStorageTotalEl = document.getElementById('node-detail-storage-total');
            if (nodeDetailStorageTotalEl) {
                nodeDetailStorageTotalEl.textContent = 
                    `${sys.root_disk_total_gb.toFixed(2)} GB`;
            }
            const nodeDetailStorageUsedEl = document.getElementById('node-detail-storage-used');
            if (nodeDetailStorageUsedEl) {
                nodeDetailStorageUsedEl.textContent = 
                    `${sys.root_disk_used_gb.toFixed(2)} GB (${storagePercent}%)`;
            }
            const nodeDetailStorageBarEl = document.getElementById('node-detail-storage-bar');
            if (nodeDetailStorageBarEl) {
                nodeDetailStorageBarEl.style.width = `${storagePercent}%`;
            }
            // 根据是否有游戏服务器信息决定是否显示"返回游戏"按钮
            const backToGameBtn = document.getElementById('back-to-game-btn');
            if (backToGameBtn) {
                backToGameBtn.style.display = hasGameServer && appConfig.currentView === 'node-details' ? 'inline-block' : 'none';
            }
        }
        
        // 初始化图表
        function initCharts() {
            const percentChartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: { 
                        enabled: true,
                        backgroundColor: 'rgba(30, 30, 40, 0.85)',
                        titleColor: '#ffffff',
                        bodyColor: '#e0e0e0',
                        borderColor: 'rgba(255, 255, 255, 0.35)',
                        borderWidth: 1,
                        padding: 12,
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}%`;
                            }
                        }
                    }
                },
                scales: {
                    x: { 
                        display: false,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.2)'
                        }
                    },
                    y: { 
                        min: 0,
                        max: 100,
                        grid: { 
                            color: 'rgba(255, 255, 255, 0.15)',
                            borderDash: [5, 5]
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.8)',
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                },
                elements: {
                    point: { radius: 0 },
                    line: { 
                        tension: 0.3,
                        borderWidth: 3
                    }
                },
                animation: {
                    duration: 300
                }
            };
            const rateChartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: { 
                        enabled: true,
                        backgroundColor: 'rgba(30, 30, 40, 0.85)',
                        titleColor: '#ffffff',
                        bodyColor: '#e0e0e0',
                        borderColor: 'rgba(255, 255, 255, 0.35)',
                        borderWidth: 1,
                        padding: 12,
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.parsed.y.toFixed(2)} Mbps`;
                            }
                        }
                    }
                },
                scales: {
                    x: { 
                        display: false,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.2)'
                        }
                    },
                    y: { 
                        beginAtZero: true,
                        grid: { 
                            color: 'rgba(255, 255, 255, 0.15)',
                            borderDash: [5, 5]
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.8)',
                            callback: function(value) {
                                return value + ' Mbps';
                            }
                        }
                    }
                },
                elements: {
                    point: { radius: 0 },
                    line: { 
                        tension: 0.3,
                        borderWidth: 3
                    }
                },
                animation: {
                    duration: 300
                }
            };
            // 磁盘图表选项（单位改为MB/s）
            const diskRateChartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: { 
                        enabled: true,
                        backgroundColor: 'rgba(30, 30, 40, 0.85)',
                        titleColor: '#ffffff',
                        bodyColor: '#e0e0e0',
                        borderColor: 'rgba(255, 255, 255, 0.35)',
                        borderWidth: 1,
                        padding: 12,
                        callbacks: {
                            label: function(context) {
                                // 修改单位显示为MB/s
                                return `${context.dataset.label}: ${context.parsed.y.toFixed(2)} MB/s`;
                            }
                        }
                    }
                },
                scales: {
                    x: { 
                        display: false,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.2)'
                        }
                    },
                    y: { 
                        beginAtZero: true,
                        grid: { 
                            color: 'rgba(255, 255, 255, 0.15)',
                            borderDash: [5, 5]
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.8)',
                            // 修改单位显示为MB/s
                            callback: function(value) {
                                return value + ' MB/s';
                            }
                        }
                    }
                },
                elements: {
                    point: { radius: 0 },
                    line: { 
                        tension: 0.3,
                        borderWidth: 3
                    }
                },
                animation: {
                    duration: 300
                }
            };
            // CPU 图表
            const cpuChartEl = document.getElementById('cpu-chart');
            if (cpuChartEl) {
                cpuChart = new Chart(cpuChartEl, {
                    type: 'line',
                    data: {
                        labels: chartData.cpu.labels,
                        datasets: [{
                            label: 'CPU 使用率',
                            data: chartData.cpu.values,
                            borderColor: '#4285f4',
                            backgroundColor: 'rgba(66, 133, 244, 0.25)',
                            fill: true
                        }]
                    },
                    options: percentChartOptions
                });
            }
            // 内存图表
            const memoryChartEl = document.getElementById('memory-chart');
            if (memoryChartEl) {
                memoryChart = new Chart(memoryChartEl, {
                    type: 'line',
                    data: {
                        labels: chartData.memory.labels,
                        datasets: [{
                            label: '内存使用率',
                            data: chartData.memory.values,
                            borderColor: '#34a853',
                            backgroundColor: 'rgba(52, 168, 83, 0.25)',
                            fill: true
                        }]
                    },
                    options: percentChartOptions
                });
            }
            // 网络图表
            const networkChartEl = document.getElementById('network-chart');
            if (networkChartEl) {
                networkChart = new Chart(networkChartEl, {
                    type: 'line',
                    data: {
                        labels: chartData.network.labels,
                        datasets: [
                            {
                                label: '下载',
                                data: chartData.network.download,
                                borderColor: '#fbbc05',
                                backgroundColor: 'rgba(251, 188, 5, 0.25)',
                                fill: true
                            },
                            {
                                label: '上传',
                                data: chartData.network.upload,
                                borderColor: '#ea4335',
                                backgroundColor: 'rgba(234, 67, 53, 0.25)',
                                fill: true
                            }
                        ]
                    },
                    options: rateChartOptions
                });
            }
            // 磁盘图表 - 使用新的选项配置
            const diskChartEl = document.getElementById('disk-chart');
            if (diskChartEl) {
                diskChart = new Chart(diskChartEl, {
                    type: 'line',
                    data: {
                        labels: chartData.disk.labels,
                        datasets: [
                            {
                                label: '读取',
                                data: chartData.disk.read,
                                borderColor: '#9c27b0',
                                backgroundColor: 'rgba(156, 39, 176, 0.25)',
                            },
                            {
                                label: '写入',
                                data: chartData.disk.write,
                                borderColor: '#00bcd4',
                                backgroundColor: 'rgba(0, 188, 212, 0.25)',
                            }
                        ]
                    },
                    options: diskRateChartOptions  // 使用专门为磁盘设计的配置
                });
            }
        }
        // 更新图表数据
        function updateChartData(chart, newData, maxPoints) {
            if (!chart || !chart.data || !chart.data.labels || !chart.data.datasets) {
                return;
            }
            if (chart.data.labels.length >= maxPoints) {
                chart.data.labels.shift();
                chart.data.datasets.forEach(dataset => dataset.data.shift());
            }
            chart.data.labels.push('');
            chart.data.datasets[0].data.push(newData);
            chart.update();
        }
        // 更新双数据图表
        function updateDualChartData(chart, newData1, newData2, maxPoints) {
            if (!chart || !chart.data || !chart.data.labels || !chart.data.datasets) {
                return;
            }
            if (chart.data.labels.length >= maxPoints) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
                chart.data.datasets[1].data.shift();
            }
            chart.data.labels.push('');
            chart.data.datasets[0].data.push(newData1);
            chart.data.datasets[1].data.push(newData2);
            chart.update();
        }
        // 获取当前节点数据
        function fetchDataForCurrentNode() {
            const currentNode = appConfig.config.nodes[appConfig.currentNodeIndex];
            fetchServerData(currentNode.apiurl);
        }
        // 获取服务器数据
        async function fetchServerData(apiUrl) {
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('服务器响应异常');
                const data = await response.json();
                if (data.code !== 200) {
                    throw new Error(`API返回错误: ${data.status || '未知错误'}`);
                }
                // 标记当前节点有游戏服务器信息
                appConfig.config.nodes[appConfig.currentNodeIndex].hasGameServer = 
                    data.hasOwnProperty('game_server_status');
                // 标记当前节点在线
                appConfig.config.nodes[appConfig.currentNodeIndex].status = 'online';
                // 更新节点状态
                updateNodeStatus(appConfig.currentNodeIndex, 'online');
                // 更新UI
                updateUI(data);
                // 隐藏离线模态框
                const offlineModal = document.getElementById('offline-modal');
                if (offlineModal) {
                    offlineModal.classList.remove('active');
                }
                // 更新状态指示器
                const statusDot = document.querySelector('.status-dot');
                const statusText = document.querySelector('.status-text');
                if (statusDot) {
                    statusDot.className = 'status-dot';
                }
                if (statusText) {
                    statusText.textContent = '运行中';
                }
            } catch (error) {
                console.error('获取数据失败:', error);
                // 标记当前节点离线
                appConfig.config.nodes[appConfig.currentNodeIndex].status = 'offline';
                // 更新节点状态
                updateNodeStatus(appConfig.currentNodeIndex, 'offline');
                // 显示离线状态（根据间隔时间）
                const currentTime = Date.now();
                if (currentTime - appConfig.lastOfflineAlertTime > appConfig.offlineAlertInterval) {
                    showOfflineStatus(`无法连接到节点: ${error.message}`);
                    appConfig.lastOfflineAlertTime = currentTime;
                }
                // 后台继续尝试连接
                setTimeout(() => {
                    fetchServerData(apiUrl);
                }, appConfig.refreshInterval * 5); // 5秒后重试
            }
        }
        // 更新节点状态显示
        function updateNodeStatus(nodeIndex, status) {
            const nodeItem = document.querySelector(`.node-item[data-index="${nodeIndex}"]`);
            if (!nodeItem) return;
            const statusDot = nodeItem.querySelector('.node-status-dot');
            const statusText = nodeItem.querySelector('.node-status-text');
            if (statusDot) {
                statusDot.className = status === 'online' ? 'node-status-dot online' : 'node-status-dot offline';
            }
            if (statusText) {
                statusText.textContent = status === 'online' ? '在线' : '离线';
            }
        }
        // 更新背景图片
        function updateBackground(bgUrl) {
            document.documentElement.style.setProperty('--background', `url('${bgUrl}')`);
        }
        // 显示离线状态
        function showOfflineStatus(message) {
            const statusDot = document.querySelector('.status-dot');
            const statusText = document.querySelector('.status-text');
            const offlineModal = document.getElementById('offline-modal');
            if (statusDot) {
                statusDot.className = 'status-dot offline';
            }
            if (statusText) {
                statusText.textContent = '连接断开';
            }
            if (offlineModal) {
                offlineModal.classList.add('active');
            }
            // 更新错误消息
            const offlineMessage = document.getElementById('offline-message');
            if (offlineMessage && message) {
                offlineMessage.textContent = message;
            }
            // 重置UI显示
            const cpuValueEl = document.getElementById('cpu-value');
            if (cpuValueEl) cpuValueEl.textContent = '0%';
            const memoryValueEl = document.getElementById('memory-value');
            if (memoryValueEl) memoryValueEl.textContent = '0GB/0GB';
            const networkValueEl = document.getElementById('network-value');
            if (networkValueEl) networkValueEl.textContent = '0Mbps';
            const diskValueEl = document.getElementById('disk-value');
            if (diskValueEl) diskValueEl.textContent = '0MB/s'; // 单位改为MB/s
            const uptimeValueEl = document.getElementById('uptime-value');
            if (uptimeValueEl) uptimeValueEl.textContent = '0小时';
            const totalUploadValueEl = document.getElementById('total-upload-value');
            if (totalUploadValueEl) totalUploadValueEl.textContent = '0.000 GB';
            const totalDownloadValueEl = document.getElementById('total-download-value');
            if (totalDownloadValueEl) totalDownloadValueEl.textContent = '0.000 GB';
            // 如果有游戏服务器状态，重置相关显示
            const playerCountEl = document.getElementById('player-count');
            if (playerCountEl) {
                playerCountEl.textContent = '0';
            }
            const tpsEl = document.getElementById('tps');
            if (tpsEl) {
                tpsEl.textContent = '0';
            }
            const versionEl = document.getElementById('version');
            if (versionEl) {
                versionEl.textContent = 'v?.?.?';
            }
            const onlinePlayersEl = document.getElementById('online-players');
            if (onlinePlayersEl) {
                onlinePlayersEl.textContent = '0/100';
            }
            const playersListEl = document.getElementById('players-list');
            if (playersListEl) {
                playersListEl.innerHTML = '<div class="no-players">服务器离线</div>';
            }
            // 更新天气为未知
            const weatherIconEl = document.getElementById('weather-icon');
            if (weatherIconEl) {
                weatherIconEl.innerHTML = '<i class="fas fa-question"></i>';
            }
            const weatherTextEl = document.getElementById('weather-text');
            if (weatherTextEl) {
                weatherTextEl.textContent = '未知';
            }
        }
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化应用
            initApp();
        });
    </script>
</body>
</html>
